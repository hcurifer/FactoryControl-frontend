<h2 mat-dialog-title>Gestión de gamas preventivas</h2>

<div mat-dialog-content class="dialog-content-scroll">

  <!-- TOOLBAR -->
  <div class="toolbar">
    <button mat-raised-button color="primary" (click)="abrirCrearGama()">
      <mat-icon>add</mat-icon>
      Nueva gama
    </button>
  </div>

  <!-- LISTADO DE GAMAS -->
  <div class="lista" *ngIf="!cargando; else loadingGamas">

    <div class="gama-card"
        *ngFor="let gama of gamas"
        (click)="seleccionarGama(gama)"
        [class.seleccionada]="gamaSeleccionada?.id_gama === gama.id_gama">

      <div class="info">
        <h3>{{ gama.nombre }}</h3>
        <p>{{ gama.descripcion || 'Sin descripción' }}</p>
      </div>

      <div class="acciones">
        <span
          class="estado"
          [class.activa]="gama.activa"
          [class.inactiva]="!gama.activa">
          {{ gama.activa ? 'Activa' : 'Inactiva' }}
        </span>

        <button
          mat-icon-button
          (click)="toggleGama(gama); $event.stopPropagation()"
          [matTooltip]="gama.activa ? 'Desactivar gama' : 'Activar gama'">
          <mat-icon>
            {{ gama.activa ? 'visibility_off' : 'visibility' }}
          </mat-icon>
        </button>
      </div>

    </div>

    <p *ngIf="gamas.length === 0" class="placeholder">
      No hay gamas preventivas creadas
    </p>

  </div>

  <!-- LOADING GAMAS -->
  <ng-template #loadingGamas>
    <p class="placeholder">Cargando gamas preventivas...</p>
  </ng-template>

  <!-- CATÁLOGO DE TAREAS -->
  <div class="catalogo" *ngIf="gamaSeleccionada">

    <h3>
      Catálogo de tareas – {{ gamaSeleccionada.nombre }}
    </h3>

    <button mat-stroked-button color="primary"
            (click)="abrirCrearTareaCatalogo()">
      <mat-icon>add</mat-icon>
      Añadir tarea
    </button>

    <div *ngIf="cargandoTareas">
      Cargando tareas...
    </div>

    <div *ngIf="!cargandoTareas && tareasCatalogo.length === 0">
      No hay tareas en esta gama
    </div>

    <div class="tarea"
         *ngFor="let tarea of tareasCatalogo">
      <strong>{{ tarea.nombre_tarea }}</strong>
      <span>{{ tarea.duracion_horas }} min</span>
    </div>

  </div>

</div>

<div mat-dialog-actions align="end">
  <button mat-button (click)="cerrar()">Cerrar</button>
</div>
